PORTNAME=	faces
PORTVERSION=	1.7.7
PORTREVISION=	1
CATEGORIES=	mail
MASTER_SITES=	SF

MAINTAINER=	ports@MidnightBSD.org
COMMENT=	Visual mail, user, and print face server
WWW=		https://faces.sourceforge.net/

LICENSE=	gpl2
LICENSE_FILE=	${WRKSRC}/COPYING

OPTIONS_DEFINE=	DOCS NLS AUDIO
OPTIONS_SINGLE=		AUDIO
OPTIONS_SINGLE_AUDIO=	NAS RPLAY SOX
AUDIO_DESC=	Audio support
RPLAY_DESC=	rplay audio support
SOX_DESC=	Sox audio support

NLS_USES=		gettext
NLS_CONFIGURE_ENABLE=	nls

OPTIONS_SUB=	yes

AUDIO_CONFIGURE_ENABLE=	audio

NAS_CONFIGURE_ON=	--with-audio-cmd=${LOCALBASE}/bin/auplay
NAS_RUN_DEPENDS=	auplay:audio/nas

SOX_CONFIGURE_ON=	--with-audio-cmd=${LOCALBASE}/bin/play
SOX_RUN_DEPENDS=	play:audio/sox

RPLAY_CONFIGURE_ON=	--with-audio-cmd=${LOCALBASE}/bin/rplay
RPLAY_RUN_DEPENDS=	rplay:audio/rplay

USE_LDCONFIG=	yes
GNU_CONFIGURE=	yes

PORTDOCS=	README

.include <bsd.mport.options.mk>

post-extract:
	${TOUCH} ${WRKSRC}/config.guess

# I have no better idea up to now
# Install the working Makefile for compface from the old faces port
# This was much less complex an builds the shared libs, too
post-patch:
	@${REINPLACE_CMD} -e "s%/usr/local/faces%${DATADIR}%g ; \
		 s%/var/spool/mail%/var/mail%g" ${WRKSRC}/faces/faces.man
	@${LN} -sf ${WRKSRC}/faces/faces.man ${WRKSRC}/faces/faces.1
.if ${PORT_OPTIONS:MNAS}
	@${REINPLACE_CMD} -e "s%rplay%auplay%" ${WRKSRC}/faces/Faces.ad
.elif ${PORT_OPTIONS:MSOX}
	@${REINPLACE_CMD} -e "s%rplay%play%" ${WRKSRC}/faces/Faces.ad
.elif ${PORT_OPTIONS:MRPLAY}
	# nada
.else
	@${REINPLACE_CMD} -e "s%^faces.audioSupport.*%faces.audioSupport:		false%" ${WRKSRC}/faces/Faces.ad
.endif

do-build:
	cd ${WRKSRC}/compface && ${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} \
		${FILESDIR}/Makefile.compface ${MAKE_ARGS} ${ALL_TARGET}

do-install:
	${INSTALL_PROGRAM} ${WRKSRC}/compface/compface ${STAGEDIR}${PREFIX}/bin
	${INSTALL_PROGRAM} ${WRKSRC}/compface/uncompface ${STAGEDIR}${PREFIX}/bin
	${INSTALL_DATA} ${WRKSRC}/compface/compface.h ${STAGEDIR}${PREFIX}/include
	${INSTALL_DATA} ${WRKSRC}/compface/libcompface.a ${STAGEDIR}${PREFIX}/lib
	${INSTALL_DATA} ${WRKSRC}/compface/libcompface.so.1 ${STAGEDIR}${PREFIX}/lib
	${LN} -sf libcompface.so.1 ${STAGEDIR}${PREFIX}/lib/libcompface.so
	${INSTALL_MAN} ${WRKSRC}/compface/compface.1 ${STAGEDIR}${PREFIX}/share/man/man1
	${INSTALL_MAN} ${WRKSRC}/compface/compface.3 ${STAGEDIR}${PREFIX}/share/man/man3
	${INSTALL_SCRIPT} ${FILESDIR}/ikon2xbm ${PREFIX}/bin
	${INSTALL_SCRIPT} ${FILESDIR}/xbm2ikon ${PREFIX}/bin
	${INSTALL_SCRIPT} ${FILESDIR}/xbmcut48 ${PREFIX}/bin
	${INSTALL_SCRIPT} ${FILESDIR}/xbmsize48 ${PREFIX}/bin
	@${MKDIR} ${STAGEDIR}${DOCSDIR}
	${INSTALL_DATA} ${WRKSRC}/README ${STAGEDIR}${DOCSDIR}

.include <bsd.port.mk>
