# $MidnightBSD: mports/dns/unbound/Makefile,v 1.3 2011/05/12 13:29:28 laffer1 Exp $

PORTNAME=	unbound
PORTVERSION=	1.4.17
CATEGORIES=	dns
MASTER_SITES=	http://unbound.net/downloads/

MAINTAINER=	ports@MidnightBSD.org
COMMENT=	A validating, recursive, and caching DNS resolver
LICENSE=	bsd3

USE_GMAKE=	yes
USE_OPENSSL=	yes
GNU_CONFIGURE=	yes
CONFIGURE_ARGS+=	--with-ssl=${OPENSSLBASE}
USE_LDCONFIG=	yes

USERS=		${PORTNAME}

USE_RC_SUBR=	unbound

MAN1=		unbound-host.1
MAN3=		libunbound.3
MAN5=		unbound.conf.5
MAN8=		unbound.8 unbound-anchor.8 unbound-control.8 unbound-checkconf.8

PORTDOCS=	CREDITS Changelog FEATURES LICENSE README README.svn \
		README.tests TODO control_proto_spec.txt ietf67-design-02.odp \
		ietf67-design-02.pdf requirements.txt
SUB_FILES=	pkg-install pkg-deinstall
PLIST_SUB+=	PYTHON=${PYTHON}

OPTIONS=	LIBEVENT "is useful when using many (10000) outgoing ports" off \
		THREADS "build with threads support" on \
		PYTHON "build python bindings" off \
		GOST "build GOST support (requires OpenSSL from ports)" off \
		ECDSA "build ECDSA (ecliptic curve) support" on

.include <bsd.mport.options.mk>

LIB_DEPENDS+=	expat.6:${PORTSDIR}/textproc/expat2 \
		ldns:${PORTSDIR}/dns/ldns

.if defined(WITH_PYTHON)
USE_PYTHON=	yes
CONFIGURE_ARGS+=	--with-pyunbound=yes --with-pythonmodule=yes
BUILD_DEPENDS+=		swig:${PORTSDIR}/devel/swig13
PYTHON=
.else
PYTHON=		"@comment "
.endif

.if defined(WITH_GOST)
WITH_OPENSSL_PORT=	yes
DEPENDS_ARGS+=	WITH_GOST=yes
.else
CONFIGURE_ARGS+=	--disable-gost
.endif

.if defined(WITH_GOST)
WITH_OPENSSL_PORT=	yes
DEPENDS_ARGS+=	WITH_ECDSA=yes
.else
CONFIGURE_ARGS+=	--disable-ecdsa
.endif

.if defined(WITH_LIBEVENT)
LIB_DEPENDS+=		event-1.4:${PORTSDIR}/devel/libevent
CONFIGURE_ARGS+=	--with-libevent=${LOCALBASE}
.else
CONFIGURE_ARGS+=	--with-libevent=no
.endif

.if !defined(WITH_THREADS)
CONFIGURE_ARGS+=	--without-pthreads
.endif

post-patch:
	@${MKDIR} ${WRKSRC}/balancer
	@${RM} ${WRKSRC}/util/configlexer.c

post-install:
.if !defined(NOPORTDOCS)
	@${MKDIR} ${DOCSDIR}; \
	for f in ${PORTDOCS}; do \
		cd ${WRKSRC}/doc && ${INSTALL_DATA} $${f} ${DOCSDIR}/; \
	done
.endif

.include <bsd.port.mk>
