# $MidnightBSD$
# $FreeBSD: head/devel/qt5-buildtools/Makefile 372179 2014-11-05 09:39:21Z rakuco $

PORTNAME=	buildtools
DISTVERSION=	${QT5_VERSION}
CATEGORIES=	devel
PKGNAMEPREFIX=	qt5-

MAINTAINER=	ports@MidnightBSD.org
COMMENT=	Qt build tools

LICENSE=	gpl3

USE_QT5=	qmake_build
QT_DIST=	base
USES=		perl5
HAS_CONFIGURE=	yes
CONFIGURE_ARGS=	-no-gui -no-xcb
USE_LDCONFIG=	${PREFIX}/${QT_LIBDIR_REL}

BUILD_WRKSRC=	${WRKSRC}/src/tools/bootstrap
INSTALL_WRKSRC=	${BUILD_WRKSRC}

MORE_WRKSRCS=	src/tools/moc \
		src/tools/rcc

post-configure:
.for d in ${MORE_WRKSRCS}
	@cd ${WRKSRC}/${d} && \
		${SETENV} ${QMAKE_ENV} ${WRKSRC}/bin/qmake ${QMAKE_ARGS}
.endfor
	${MKDIR} ${FAKE_DESTDIR}${TRUE_PREFIX}/${QT_BINDIR_REL}

post-build:
.for d in ${MORE_WRKSRCS}
	@cd ${WRKSRC}/${d} && \
		${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} ${MAKEFILE} \
		${_MAKE_JOBS} ${MAKE_ARGS} ${FAKE_MAKEARGS} ${ALL_TARGET}
.endfor

post-install:
.for d in ${MORE_WRKSRCS}
	@cd ${WRKSRC}/${d} && \
		${SETENV} ${MAKE_ENV} ${MAKE} ${MAKE_FLAGS} ${MAKEFILE} \
		${MAKE_ARGS} ${FAKE_MAKEARGS} ${INSTALL_TARGET}
.endfor
	${INSTALL_SCRIPT} ${WRKSRC}/bin/syncqt.pl \
		${PREFIX}/${QT_BINDIR_REL}/syncqt.pl
	-${CP} ${PREFIX}/lib/pkgconfig/Qt5Bootstrap.pc ${PREFIX}/libdata/pkgconfig/


.include <bsd.port.mk>
