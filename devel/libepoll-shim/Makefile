PORTNAME=	libepoll-shim
DISTVERSIONPREFIX=    v
DISTVERSION=	0.0.20210418
PORTREVISION=	1
CATEGORIES=	devel

MAINTAINER=	ports@MidnightBSD.org
COMMENT=	Small epoll implementation using kqueue

LICENSE=	mit
LICENSE_FILE=	${WRKSRC}/LICENSE

USES=		cmake compiler:c++17-lang
USE_LDCONFIG=	yes
USE_GITHUB=	yes
GH_ACCOUNT=	jiixyj
GH_PROJECT=	epoll-shim

PLIST_SUB=    SHIM_EVENTFD="${exists(/usr/include/sys/eventfd.h):?@comment :}"

CC=	clang10
MAKE_ENV+=	CC=clang10
LLVM_DEFAULT=   10
BUILD_DEPENDS+= llvm${LLVM_DEFAULT}>=3.9.0_4:devel/llvm${LLVM_DEFAULT}                                                                                                    
RUN_DEPENDS+=   llvm${LLVM_DEFAULT}>=3.9.0_4:devel/llvm${LLVM_DEFAULT}                                                                                                    
CONFIGURE_ENV+= LLVM_CONFIG=${LOCALBASE}/bin/llvm-config${LLVM_DEFAULT}                                                                                                   
LDFLAGS+=       -Wl,-rpath=${LOCALBASE}/llvm${LLVM_DEFAULT}/lib   

NO_TEST=	yes

.include <bsd.port.mk>
