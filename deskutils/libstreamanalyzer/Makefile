# $MidnightBSD: mports/deskutils/libstreamanalyzer/Makefile,v 1.1 2013/07/16 12:23:59 laffer1 Exp $

PORTNAME=	libstreamanalyzer
PORTVERSION=	${STRIGI_VERSION}
PORTREVISION=	2
CATEGORIES=	deskutils
MASTER_SITES=	${STRIGI_MASTER_SITES}

MAINTAINER=	ports@MidnightBSD.org
COMMENT=	Strigi desktop search: streamanalyzer library

LICENSE=	gpl2

LIB_DEPENDS=	avcodec${FFMPEG_SUFFIX}:${PORTSDIR}/multimedia/ffmpeg${FFMPEG_SUFFIX} \
		clucene-core:${PORTSDIR}/textproc/clucene \
		exiv2:${PORTSDIR}/graphics/exiv2 \
		streams:${PORTSDIR}/deskutils/libstreams

USES=		pkgconfig iconv
USE_GNOME=	libxml2
USE_LDCONFIG=	yes
MAKE_JOBS_SAFE=	yes

# supported versions: ffmpeg, ffmpeg1, ffmpeg-devel
# corresponding FFMPEG_SUFFIX: '', '1', '-devel'
FFMPEG_SUFFIX?=	
CMAKE_ARGS+=	-DFFMPEG_SUFFIX:STRING="${FFMPEG_SUFFIX}"

.if !empty(FFMPEG_SUFFIX)
# Reorder include directories to allow build with multiple ffmpeg installed.
# This patch must NOT be used, if ffmpeg headers are installed
# directly to ${LOCALBASE}/include
EXTRA_PATCHES+=	${FILESDIR}/extrapatch-libstreamanalyzer__plugins__endplugins__CMakeLists.txt
.endif

post-patch:
	${REINPLACE_CMD} -e \
		's,$${LIB_DESTINATION}/pkgconfig,libdata/pkgconfig,' \
		${WRKSRC}/libstreamanalyzer/CMakeLists.txt

.include <${.CURDIR}/../strigi/Makefile.common>
.include <bsd.port.mk>
