# $MidnightBSD$

PORTNAME=	libxml2
PORTVERSION=	2.8.0
PORTREVISION?=	2
CATEGORIES?=	textproc gnome
MASTER_SITES=	ftp://xmlsoft.org/libxml2/ \
		http://xmlsoft.org/sources/ \
		ftp://gd.tuwien.ac.at/pub/libxml/
DIST_SUBDIR=	gnome2

MAINTAINER?=	ports@MidnightBSD.org
COMMENT?=	XML parser library for GNOME
LICENSE=	bsd3

.if !defined(REFERENCE_PORT)
USE_CSTD=	gnu89
GNU_CONFIGURE=	yes
USES=		pathfix gmake iconv pkgconfig
USE_LDCONFIG=	yes
CONFIGURE_ARGS?=--with-iconv=${ICONV_PREFIX} \
		--with-html-dir=${PREFIX}/share/doc \
		--with-html-subdir=${PORTNAME} \
		--with-lzma=/usr \
		--without-python

.if !defined(MASTERDIR)
OPTIONS_DEFINE= SCHEMA THREADS MEM_DEBUG XMLLINT_HIST THREAD_ALLOC
OPTIONS_DEFAULT=SCHEMA THREADS

SCHEMA_DESC=	XML schema support
SCHEMA_CONFIGURE_WITH=	schemas
THREADS_DESC=	Threads support
THREADS_CONFIGURE_WITH=	threads
MEM_DEBUG_DESC= Memory debugging (DEVELOPERS ONLY!)
MEM_DEBUG_CONFIGURE_WITH=	mem-debug
XMLLINT_HIST_DESC= History for xmllint
XMLLINT_HIST_CONFIGURE_WITH=	history
THREAD_ALLOC_DESC= Per-thread memory (DEVELOPERS ONLY!)
THREAD_ALLOC_CONFIGURE_WITH=	thread-alloc
.endif # !defined(MASTERDIR)

post-patch:
.for d in . doc doc/devhelp doc/examples
	@${REINPLACE_CMD} -e '/^install-data-am:/ s|install-data-local||' \
	    ${WRKSRC}/${d}/Makefile.in
.endfor
.for f in catalog.c xmlcatalog.c xmllint.c doc/xmllint.1
	@${REINPLACE_CMD} -e \
	    's|/etc/xml/catalog|${LOCALBASE}/share/xml/catalog|g; \
	     s|/etc/sgml/catalog|${LOCALBASE}/share/sgml/catalog|g' \
	    ${WRKSRC}/${f}
.endfor
# manual patch because WITH_FBSD10_FIX break the python bindings
	${FIND} ${WRKSRC} -type f -name configure \
		-exec ${SH} -c " \
		mtime=\$$(date -r \$$(stat -f '%m' \$$0) '+%Y%m%d%H%M.%S'); \
		${SED} -i '.batman' -e 's|freebsd1\*)|freebsd1.\*)|g' \
		-e 's|freebsd\[123\]\*)|freebsd[123].*)|g' \$$0; \
		touch -mt \$$mtime \$$0" {} \; || /usr/bin/true

.include <bsd.port.mk>

.endif
